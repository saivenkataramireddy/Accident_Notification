{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Police Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Segoe UI", sans-serif;
}

body {
    background: #0f172a;
    color: #e5e7eb;
}

/* ===== HEADER ===== */
.topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    background: #020617;
    border-bottom: 2px solid #1e293b;
}

.logo {
    font-size: 20px;
    font-weight: bold;
}

.profile {
    display: flex;
    gap: 16px;
    align-items: center;
}

.logout {
    color: #ef4444;
    text-decoration: none;
    font-weight: bold;
}

/* ===== DASHBOARD ===== */
.dashboard {
    padding: 24px;
}

/* ===== STATS ===== */
.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 16px;
    margin-bottom: 24px;
}

.stats .card {
    background: #020617;
    padding: 16px;
    border-radius: 12px;
    text-align: center;
}

.stats .card.red { border-left: 4px solid #ef4444; }
.stats .card.green { border-left: 4px solid #22c55e; }

/* ===== ALERTS ===== */
.alerts h2 {
    margin-bottom: 16px;
}

.alert-box {
    background: #020617;
    border-left: 6px solid #ef4444;
    padding: 16px;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    margin-bottom: 16px;
    animation: slideIn 0.4s ease;
}

.alert-box.resolved {
    border-left-color: #22c55e;
    opacity: 0.7;
}

.left h3 {
    margin-bottom: 6px;
}

.tag {
    display: inline-block;
    margin-top: 8px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: bold;
}

.critical {
    background: #ef4444;
}

.right {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* ===== BUTTONS ===== */
.btn {
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}

.map { background: #0ea5e9; }
.warn { background: #f59e0b; }
.success { background: #22c55e; }

input {
    padding: 6px;
    border-radius: 6px;
    border: none;
}

.resolved-text {
    color: #22c55e;
    font-weight: bold;
}

/* ===== ANIMATION ===== */
@keyframes slideIn {
    from { transform: translateY(20px); opacity: 0 }
    to { transform: translateY(0); opacity: 1 }
}

.empty {
    text-align: center;
    opacity: 0.7;
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="topbar">
    <div class="logo">üöî Police Control Panel</div>
    <div class="profile">
        <span>{{ request.user.username }}</span>
        <a href="{% url 'logout' %}" class="logout">Logout</a>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="dashboard">

    <!-- ===== STATS ===== -->
    <section class="stats">
        <div class="card">
            <h3>Total Cases</h3>
            <p>{{ alerts|length }}</p>
        </div>
        <div class="card red">
            <h3>Active</h3>
            <p>{{ alerts|length }}</p>
        </div>
        <div class="card green">
            <h3>Resolved</h3>
            <p>{{ alerts|length }}</p>
        </div>
    </section>

    <!-- ===== MISSING PERSON ALERT ===== -->
<section class="alerts">
    <h2>üßí Missing Person Alert</h2>

    <div class="alert-box">
        <div class="left">
            <h3>üöî Missing Person Broadcast</h3>
            <p>Send alert within <strong>5 km</strong> with photo & address</p>
            <span class="tag critical">HIGH PRIORITY</span>
        </div>

        <div class="right">
            <form method="POST"
                  action="{% url 'police_missing_person_broadcast' %}"
                  enctype="multipart/form-data">

                {% csrf_token %}

                <input type="text"
                       name="message"
                       placeholder="Eg: Child missing, age 7, wearing red shirt"
                       required>

                <input type="text"
                       name="address"
                       placeholder="Last seen location (manual address)"
                       required>

                <input type="file"
                       name="photo"
                       accept="image/*"
                       required>

                <button class="btn warn">üö® Send Alert</button>
            </form>
        </div>
    </div>
</section>

    <!-- ===== ALERT LIST ===== -->
    <section class="alerts">
        <h2>üö® Live Emergency Cases</h2>

        {% for a in alerts %}
        <div class="alert-box {% if a.status == 'resolved' %}resolved{% endif %}">
            <div class="left">
                <h3>üìç {{ a.alert.address }}</h3>
                <p><strong>Reported By:</strong> {{ a.alert.user.username }}</p>
                <p><strong>Time:</strong> {{ a.created_at }}</p>
                <span class="tag critical">CRITICAL</span>
            </div>

            <div class="right">
                <a class="btn map"
                   target="_blank"
                   href="https://maps.google.com/?q={{ a.alert.latitude }},{{ a.alert.longitude }}">
                    üó∫ Navigate
                </a>

                <form method="POST" action="{% url 'police_broadcast' a.id %}">
                    {% csrf_token %}
                    <input type="text" name="message" placeholder="Broadcast message" required>
                    <button class="btn warn">üì¢ Broadcast</button>
                </form>

                {% if a.status != "resolved" %}
                <form method="POST" action="{% url 'resolve_alert' a.id %}">
                    {% csrf_token %}
                    <button class="btn success">‚úÖ Mark Resolved</button>
                </form>
                {% else %}
                <span class="resolved-text">‚úî Resolved</span>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p class="empty">No emergency cases right now üö®</p>
        {% endfor %}
    </section>



</main>

</body>
</html>
